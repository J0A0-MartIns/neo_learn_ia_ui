<div class="loading-overlay" *ngIf="isLoading">
  <div class="spinner-container">
    <mat-spinner diameter="60" color="primary"></mat-spinner>
    <p>Gerando seu cronograma personalizado...</p>
    <small>Isso pode levar alguns segundos.</small>
  </div>
</div>



<div class="schedule-container" *ngIf="scheduleData && !isLoading">
  <h1 class="title">Cronograma de Estudos ({{ scheduleData.totalWeeks }} semanas)</h1>
  <p class="daily-hours">
    Horas diárias previstas: <strong>{{ scheduleData.dailyStudyHours }}</strong>
  </p>

  <div class="week-pagination">
    <button
      class="week-button"
      *ngFor="let week of scheduleData.schedule"
      (click)="setCurrentWeek(week.week)"
      [class.active]="currentWeek === week.week"
    >
      Semana {{ week.week }}
    </button>
  </div>

  <div class="weeks-container">
    <div class="week-card" *ngFor="let week of scheduleData.schedule">
      
      <ng-container *ngIf="week.week === currentWeek">
        <h2 class="week-title">Semana {{ week.week }}</h2>

        <div class="days-container">
          <div class="day-card" *ngFor="let day of week.days">
            <h3 class="day-title">{{ day.day }}</h3>

            <div class="topics-list">
              <div
                class="topic-card"
                *ngFor="let topic of day.studyTopics"
                [ngClass]="getDifficultyColor(topic.difficulty)"
              >
                <div class="topic-header">
                  <span class="topic-difficulty">{{ topic.difficulty }}</span>
                  <span class="topic-hours">{{ topic.allocatedHours }}h</span>
                </div>
                <p class="topic-name">{{ topic.topicName }}</p>
              </div>
            </div>

          </div>
        </div>
      </ng-container>

    </div>
  </div>
</div>
<div class="no-schedule-options-container" *ngIf="!scheduleData">
  <mat-card class="option-card view-schedule-card">
    <mat-card-header>
      <mat-card-title>
        <span class="material-icons"> visibility </span>
        Seus Cronogramas Salvos
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      
      <table mat-table [dataSource]="schedulesList" class="full-width-table">

        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef> Título </th>
          <td mat-cell *matCellDef="let element"> {{element.title}} </td>
        </ng-container>

        <ng-container matColumnDef="projectName">
          <th mat-header-cell *matHeaderCellDef> Repositório </th>
          <td mat-cell *matCellDef="let element"> {{element.projectName}} </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Ações </th>
          <td mat-cell *matCellDef="let element">
            <button mat-icon-button color="primary" (click)="viewSchedule(element.id)" aria-label="Ver Cronograma">
              <mat-icon>remove_red_eye</mat-icon>
            </button>
            <button mat-icon-button color="warn"  (click)="deleteSchedule(element.id)" aria-label="Excluir Cronograma">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
      
      <p *ngIf="!schedulesList || schedulesList.length === 0" class="no-data-message">
        Nenhum cronograma salvo ainda.
      </p>

    </mat-card-content>
  </mat-card>
  
  <mat-card class="option-card create-schedule-card">
  </mat-card>

  <mat-card class="option-card create-schedule-card">
    <mat-card-header>
      <mat-card-title>
        <span class="material-icons"> add_box </span>
        Criar Cronograma
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p>Comece do zero e crie um novo plano de estudos personalizado para você.</p>
    </mat-card-content>
    <mat-card-actions>
      <button mat-button class="option-button secondary-button" (click)="openCreateScheduleDialog()">NOVO CRONOGRAMA</button>
    </mat-card-actions>
  </mat-card>
</div>